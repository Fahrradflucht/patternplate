'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _taggedTemplateLiteral2 = require('babel-runtime/helpers/taggedTemplateLiteral');

var _taggedTemplateLiteral3 = _interopRequireDefault(_taggedTemplateLiteral2);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _templateObject = (0, _taggedTemplateLiteral3.default)(['', ''], ['', '']);

exports.btoa = btoa;
exports.parse = parse;
exports.png = png;
exports.purge = purge;
exports.render = render;
exports.sanitize = sanitize;
exports.stringify = stringify;

var _btoa = require('btoa');

var _btoa2 = _interopRequireDefault(_btoa);

var _react = require('react');

var _styledComponents = require('styled-components');

var _styledComponents2 = _interopRequireDefault(_styledComponents);

var _xmldom = require('xmldom');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var parser = new _xmldom.DOMParser();
var serializer = new _xmldom.XMLSerializer();

var TAG_NAMES = ['circle', 'g', 'path', 'polygon', 'rect', 'svg'];

var ATTRIBUTES = {
	circle: ['cx', 'cy', 'r', 'fill', 'stroke', 'style'],
	g: ['x', 'y', 'style'],
	path: ['d', 'fill', 'stroke', 'style'],
	polygon: ['points', 'fill', 'stroke', 'style'],
	rect: ['x', 'y', 'width', 'height', 'fill', 'stroke', 'style'],
	svg: ['width', 'height', 'viewBox', 'x', 'y', 'style', 'xmlns']
};

function attributes(node, key) {
	return (ATTRIBUTES[node.tagName] || []).reduce(function (props, name) {
		var attribute = node.attributes.getNamedItem(name);
		if (attribute && attribute.specified) {
			props[name] = attribute.value;
		}
		return props;
	}, { key: key });
}

function btoa(source) {
	return 'data:image/svg+xml;base64,' + (0, _btoa2.default)(source);
}

function parse(source) {
	var doc = parser.parseFromString(source, 'image/svg+xml');
	var parsed = [].concat((0, _toConsumableArray3.default)(doc.childNodes)).find(function (node) {
		return node.tagName === 'svg';
	});
	parsed.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
	return parsed;
}

function png(source) {
	return new _promise2.default(function (resolve, reject) {
		var img = new global.Image();
		var canvas = global.document.createElement('canvas');
		var ratio = global.devicePixelRatio || 1;

		canvas.width = 16 * ratio;
		canvas.height = 16 * ratio;

		var context = canvas.getContext('2d');

		img.onload = function () {
			context.drawImage(img, 0, 0);
			resolve(canvas.toDataURL('image/png'));
		};

		img.onerror = function (err) {
			return reject(err);
		};

		img.src = btoa(source);
	});
}

function purge(parsed) {
	return [].concat((0, _toConsumableArray3.default)(parsed)).filter(function (node) {
		return TAG_NAMES.includes(node.tagName);
	}).map(function (node) {
		node.childNodes = purge(node.childNodes);

		var attributes = ATTRIBUTES[node.tagName] || [];

		for (var i = 0; i < node.attributes.length; i++) {
			var attribute = node.attributes[i];
			if (!attributes.includes(attribute.name)) {
				node.removeAttribute(attribute.name);
			}
		}

		return node;
	});
}

function render(element) {
	var _element = (0, _slicedToArray3.default)(element, 3),
	    tagName = _element[0],
	    props = _element[1],
	    _element$ = _element[2],
	    children = _element$ === undefined ? [] : _element$;

	var style = props.style,
	    rest = (0, _objectWithoutProperties3.default)(props, ['style']);

	var tag = (0, _styledComponents2.default)(tagName)(_templateObject, style);
	return (0, _react.createElement)(tag, rest, children.map(function (c) {
		return render(c);
	}));
}

function sanitize(parsed) {
	return [].concat((0, _toConsumableArray3.default)(parsed)).map(function (node, i) {
		return [node.tagName, attributes(node, i), sanitize(node.childNodes)];
	});
}

function stringify(tree) {
	return serializer.serializeToString(tree);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9hcHBsaWNhdGlvbi91dGlscy9zdmcuanMiXSwibmFtZXMiOlsiYnRvYSIsInBhcnNlIiwicG5nIiwicHVyZ2UiLCJyZW5kZXIiLCJzYW5pdGl6ZSIsInN0cmluZ2lmeSIsInBhcnNlciIsInNlcmlhbGl6ZXIiLCJUQUdfTkFNRVMiLCJBVFRSSUJVVEVTIiwiY2lyY2xlIiwiZyIsInBhdGgiLCJwb2x5Z29uIiwicmVjdCIsInN2ZyIsImF0dHJpYnV0ZXMiLCJub2RlIiwia2V5IiwidGFnTmFtZSIsInJlZHVjZSIsInByb3BzIiwibmFtZSIsImF0dHJpYnV0ZSIsImdldE5hbWVkSXRlbSIsInNwZWNpZmllZCIsInZhbHVlIiwic291cmNlIiwiZG9jIiwicGFyc2VGcm9tU3RyaW5nIiwicGFyc2VkIiwiY2hpbGROb2RlcyIsImZpbmQiLCJzZXRBdHRyaWJ1dGUiLCJyZXNvbHZlIiwicmVqZWN0IiwiaW1nIiwiZ2xvYmFsIiwiSW1hZ2UiLCJjYW52YXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJyYXRpbyIsImRldmljZVBpeGVsUmF0aW8iLCJ3aWR0aCIsImhlaWdodCIsImNvbnRleHQiLCJnZXRDb250ZXh0Iiwib25sb2FkIiwiZHJhd0ltYWdlIiwidG9EYXRhVVJMIiwib25lcnJvciIsImVyciIsInNyYyIsImZpbHRlciIsImluY2x1ZGVzIiwibWFwIiwiaSIsImxlbmd0aCIsInJlbW92ZUF0dHJpYnV0ZSIsImVsZW1lbnQiLCJjaGlsZHJlbiIsInN0eWxlIiwicmVzdCIsInRhZyIsImMiLCJ0cmVlIiwic2VyaWFsaXplVG9TdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7UUFxQ2dCQSxJLEdBQUFBLEk7UUFJQUMsSyxHQUFBQSxLO1FBT0FDLEcsR0FBQUEsRztRQXNCQUMsSyxHQUFBQSxLO1FBbUJBQyxNLEdBQUFBLE07UUFPQUMsUSxHQUFBQSxRO1FBS0FDLFMsR0FBQUEsUzs7QUFy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LDBCQUFFRSxHQUFGLEVBQU9ELElBQVAsRUFBYUYsU0FBU0wsR0FBVCxDQUFhO0FBQUEsU0FBS3JELE9BQU84RCxDQUFQLENBQUw7QUFBQSxFQUFiLENBQWIsQ0FBUDtBQUNBOztBQUVNLFNBQVM3RCxRQUFULENBQWtCMEIsTUFBbEIsRUFBMEI7QUFDaEMsUUFBTywyQ0FBSUEsTUFBSixHQUNMMEIsR0FESyxDQUNELFVBQUN2QyxJQUFELEVBQU93QyxDQUFQO0FBQUEsU0FBYSxDQUFDeEMsS0FBS0UsT0FBTixFQUFlSCxXQUFXQyxJQUFYLEVBQWlCd0MsQ0FBakIsQ0FBZixFQUFvQ3JELFNBQVNhLEtBQUtjLFVBQWQsQ0FBcEMsQ0FBYjtBQUFBLEVBREMsQ0FBUDtBQUVBOztBQUVNLFNBQVMxQixTQUFULENBQW1CNkQsSUFBbkIsRUFBeUI7QUFDL0IsUUFBTzNELFdBQVc0RCxpQkFBWCxDQUE2QkQsSUFBN0IsQ0FBUDtBQUNBIiwiZmlsZSI6InN2Zy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBiIGZyb20gJ2J0b2EnO1xuaW1wb3J0IHtjcmVhdGVFbGVtZW50IGFzIGh9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtET01QYXJzZXIsIFhNTFNlcmlhbGl6ZXJ9IGZyb20gJ3htbGRvbSc7XG5cbmNvbnN0IHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcbmNvbnN0IHNlcmlhbGl6ZXIgPSBuZXcgWE1MU2VyaWFsaXplcigpO1xuXG5jb25zdCBUQUdfTkFNRVMgPSBbXG5cdCdjaXJjbGUnLFxuXHQnZycsXG5cdCdwYXRoJyxcblx0J3BvbHlnb24nLFxuXHQncmVjdCcsXG5cdCdzdmcnXG5dO1xuXG5jb25zdCBBVFRSSUJVVEVTID0ge1xuXHRjaXJjbGU6IFsnY3gnLCAnY3knLCAncicsICdmaWxsJywgJ3N0cm9rZScsICdzdHlsZSddLFxuXHRnOiBbJ3gnLCAneScsICdzdHlsZSddLFxuXHRwYXRoOiBbJ2QnLCAnZmlsbCcsICdzdHJva2UnLCAnc3R5bGUnXSxcblx0cG9seWdvbjogWydwb2ludHMnLCAnZmlsbCcsICdzdHJva2UnLCAnc3R5bGUnXSxcblx0cmVjdDogWyd4JywgJ3knLCAnd2lkdGgnLCAnaGVpZ2h0JywgJ2ZpbGwnLCAnc3Ryb2tlJywgJ3N0eWxlJ10sXG5cdHN2ZzogWyd3aWR0aCcsICdoZWlnaHQnLCAndmlld0JveCcsICd4JywgJ3knLCAnc3R5bGUnLCAneG1sbnMnXVxufTtcblxuZnVuY3Rpb24gYXR0cmlidXRlcyhub2RlLCBrZXkpIHtcblx0cmV0dXJuIChBVFRSSUJVVEVTW25vZGUudGFnTmFtZV0gfHwgW10pXG5cdFx0LnJlZHVjZSgocHJvcHMsIG5hbWUpID0+IHtcblx0XHRcdGNvbnN0IGF0dHJpYnV0ZSA9IG5vZGUuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW0obmFtZSk7XG5cdFx0XHRpZiAoYXR0cmlidXRlICYmIGF0dHJpYnV0ZS5zcGVjaWZpZWQpIHtcblx0XHRcdFx0cHJvcHNbbmFtZV0gPSBhdHRyaWJ1dGUudmFsdWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcHJvcHM7XG5cdFx0fSwge2tleX0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnRvYShzb3VyY2UpIHtcblx0cmV0dXJuIGBkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCR7Yihzb3VyY2UpfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZShzb3VyY2UpIHtcblx0Y29uc3QgZG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhzb3VyY2UsICdpbWFnZS9zdmcreG1sJyk7XG5cdGNvbnN0IHBhcnNlZCA9IFsuLi5kb2MuY2hpbGROb2Rlc10uZmluZChub2RlID0+IG5vZGUudGFnTmFtZSA9PT0gJ3N2ZycpO1xuXHRwYXJzZWQuc2V0QXR0cmlidXRlKCd4bWxucycsICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycpO1xuXHRyZXR1cm4gcGFyc2VkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcG5nKHNvdXJjZSkge1xuXHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdGNvbnN0IGltZyA9IG5ldyBnbG9iYWwuSW1hZ2UoKTtcblx0XHRjb25zdCBjYW52YXMgPSBnbG9iYWwuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG5cdFx0Y29uc3QgcmF0aW8gPSBnbG9iYWwuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxO1xuXG5cdFx0Y2FudmFzLndpZHRoID0gMTYgKiByYXRpbztcblx0XHRjYW52YXMuaGVpZ2h0ID0gMTYgKiByYXRpbztcblxuXHRcdGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuXHRcdGltZy5vbmxvYWQgPSAoKSA9PiB7XG5cdFx0XHRjb250ZXh0LmRyYXdJbWFnZShpbWcsIDAsIDApO1xuXHRcdFx0cmVzb2x2ZShjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKSk7XG5cdFx0fTtcblxuXHRcdGltZy5vbmVycm9yID0gZXJyID0+IHJlamVjdChlcnIpO1xuXG5cdFx0aW1nLnNyYyA9IGJ0b2Eoc291cmNlKTtcblx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwdXJnZShwYXJzZWQpIHtcblx0cmV0dXJuIFsuLi5wYXJzZWRdXG5cdFx0LmZpbHRlcihub2RlID0+IFRBR19OQU1FUy5pbmNsdWRlcyhub2RlLnRhZ05hbWUpKVxuXHRcdC5tYXAobm9kZSA9PiB7XG5cdFx0XHRub2RlLmNoaWxkTm9kZXMgPSBwdXJnZShub2RlLmNoaWxkTm9kZXMpO1xuXG5cdFx0XHRjb25zdCBhdHRyaWJ1dGVzID0gQVRUUklCVVRFU1tub2RlLnRhZ05hbWVdIHx8IFtdO1xuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IG5vZGUuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRjb25zdCBhdHRyaWJ1dGUgPSBub2RlLmF0dHJpYnV0ZXNbaV07XG5cdFx0XHRcdGlmICghYXR0cmlidXRlcy5pbmNsdWRlcyhhdHRyaWJ1dGUubmFtZSkpIHtcblx0XHRcdFx0XHRub2RlLnJlbW92ZUF0dHJpYnV0ZShhdHRyaWJ1dGUubmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG5vZGU7XG5cdFx0fSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXIoZWxlbWVudCkge1xuXHRjb25zdCBbdGFnTmFtZSwgcHJvcHMsIGNoaWxkcmVuID0gW11dID0gZWxlbWVudDtcblx0Y29uc3Qge3N0eWxlLCAuLi5yZXN0fSA9IHByb3BzO1xuXHRjb25zdCB0YWcgPSBzdHlsZWQodGFnTmFtZSlgJHtzdHlsZX1gO1xuXHRyZXR1cm4gaCh0YWcsIHJlc3QsIGNoaWxkcmVuLm1hcChjID0+IHJlbmRlcihjKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2FuaXRpemUocGFyc2VkKSB7XG5cdHJldHVybiBbLi4ucGFyc2VkXVxuXHRcdC5tYXAoKG5vZGUsIGkpID0+IFtub2RlLnRhZ05hbWUsIGF0dHJpYnV0ZXMobm9kZSwgaSksIHNhbml0aXplKG5vZGUuY2hpbGROb2RlcyldKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ2lmeSh0cmVlKSB7XG5cdHJldHVybiBzZXJpYWxpemVyLnNlcmlhbGl6ZVRvU3RyaW5nKHRyZWUpO1xufVxuIl19