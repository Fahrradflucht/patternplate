'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.selectActiveItem = exports.selectSuggestion = exports.selectDocs = exports.selectLegend = exports.selectPatterns = exports.selectFound = undefined;

var _fuse = require('fuse.js');

var _fuse2 = _interopRequireDefault(_fuse);

var _seamlessImmutable = require('seamless-immutable');

var _seamlessImmutable2 = _interopRequireDefault(_seamlessImmutable);

var _lodash = require('lodash');

var _reselect = require('reselect');

var _semver = require('semver');

var _semver2 = _interopRequireDefault(_semver);

var _pool = require('./pool');

var _pool2 = _interopRequireDefault(_pool);

var _search = require('./search');

var _relation = require('./relation');

var _relation2 = _interopRequireDefault(_relation);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var FLAGS = {
	alpha: 0,
	beta: 1,
	rc: 2,
	stable: 3,
	deprecated: 4
};

var FIELDS = [{
	type: 'field',
	key: 'depends',
	value: 'depends',
	description: 'patterns depending on id',
	operators: ['=', '!=', '^=', '~=']
}, {
	type: 'field',
	key: 'has',
	value: 'has',
	description: 'pattern featuring data of [value]',
	operators: ['=', '!=']
}, {
	type: 'field',
	key: 'provides',
	value: 'provides',
	description: 'patterns providing for id',
	operators: ['=', '!=', '^=', '~=']
}, {
	type: 'field',
	key: 'tags',
	value: 'tags',
	description: 'pattern manifest .tags',
	operators: ['=', '!=', '^=', '~=']
}, {
	type: 'field',
	key: 'version',
	value: 'version',
	description: 'semantic version of pattern',
	operators: ['=', '!=', '>', '>=', '<', '<=', '^=', '~=']
}, {
	type: 'field',
	key: 'flag',
	value: 'flag',
	description: 'stability flag of pattern',
	operators: ['=', '!=', '>', '>=', '<', '<=', '^=', '~=']
}];

var OPERATORS = [{
	type: 'op',
	key: '=',
	description: 'exact match'
}, {
	type: 'op',
	key: '!=',
	description: 'negated match'
}, {
	type: 'op',
	key: '>',
	description: 'greater than'
}, {
	type: 'op',
	key: '>=',
	description: 'greater than or equal'
}, {
	type: 'op',
	key: '<',
	description: 'lesser than'
}, {
	type: 'op',
	key: '<=',
	description: 'lesser than or equal'
}, {
	type: 'op',
	key: '^=',
	description: 'starts with'
}, {
	type: 'op',
	key: '~=',
	description: 'contains'
}];

var selectFuse = (0, _reselect.createSelector)(_pool2.default, function (pool) {
	return new _fuse2.default(pool, {
		id: 'id',
		keys: ['id', 'contents', 'mainfest.displayName', 'manifest.name', 'manifest.version', 'manifest.tags', 'manifest.flag']
	});
});

var selectMatches = (0, _reselect.createSelector)(function (state) {
	return state.search;
}, selectFuse, _pool2.default, function (search, fuse, pool) {
	if (typeof search !== 'string' || search.length < 3) {
		return [];
	}

	var perform = (0, _search.apply)(fuse, pool);
	var query = (0, _search.parse)(search);
	return perform(query);
});

var selectParsedValue = (0, _reselect.createSelector)(function (state) {
	return state.searchValue;
}, function (search) {
	return (0, _search.parse)(search);
});

var selectLastQuery = (0, _reselect.createSelector)(selectParsedValue, function (parsed) {
	return last(parsed);
});

function last(query) {
	switch (query.type) {
		case 'string':
			return query.value;
		case 'and':
		case 'or':
		default:
			{
				var q = query || {};
				var values = q.values || [];
				var cand = values[values.length - 1];
				return cand ? last(cand) : '';
			}
	}
}

var selectFields = (0, _reselect.createSelector)(selectLastQuery, function (query) {
	return FIELDS.filter(function (f) {
		return f.value.startsWith(query);
	});
});

var selectFieldHit = (0, _reselect.createSelector)(function (state) {
	return state.searchValue;
}, selectLastQuery, function (value, query) {
	if (query.length === 0) {
		return null;
	}

	return FIELDS.find(function (f) {
		return query.startsWith(f.value);
	});
});

var selectParsedQuery = (0, _reselect.createSelector)(selectLastQuery, function (query) {
	return (0, _search.parseTerm)(query);
});

var selectOps = (0, _reselect.createSelector)(selectParsedQuery, selectFieldHit, function (parsed, hit) {
	if (!hit) {
		return [];
	}
	return hit.operators.map(function (o) {
		return OPERATORS.find(function (op) {
			return op.key === o;
		});
	}).filter(function (o) {
		return !parsed.operators || o.key.includes(parsed.operators);
	}).map(function (o) {
		o.value = '' + hit.value + o.key;
		return o;
	});
});

var selectOpsHit = (0, _reselect.createSelector)(selectParsedQuery, selectOps, function (query, ops) {
	return ops.find(function (i) {
		if (query.negated) {
			return i.key === '!' + query.operators;
		}
		return i.key === query.operators;
	});
});

var selectFound = exports.selectFound = (0, _reselect.createSelector)(_pool2.default, selectMatches, function (pool, matches) {
	var sorted = (0, _lodash.uniqBy)((0, _lodash.sortBy)(matches.map(function (match) {
		return pool.find(function (p) {
			return p.id === match;
		});
	}), 'type'), 'id');
	return sorted.filter(function (s) {
		return s.type !== 'folder';
	}).map(function (s, i) {
		return _seamlessImmutable2.default.set(s, 'index', i);
	});
});

var selectPatterns = exports.selectPatterns = (0, _reselect.createSelector)(selectFound, function (found) {
	return found.filter(function (f) {
		return f.type === 'pattern';
	});
});

var selectPatternPool = (0, _reselect.createSelector)(_pool2.default, function (pool) {
	return pool.filter(function (f) {
		return f.type === 'pattern';
	});
});

var selectOptions = (0, _reselect.createSelector)(selectPatternPool, selectParsedQuery, selectFieldHit, selectOpsHit, function (patterns, parsed, field, op) {
	if (!field || !op) {
		return [];
	}

	switch (field.key) {
		case 'has':
			return [{
				type: 'quality',
				key: 'docs',
				value: [field.key, op.key, 'docs'].join(''),
				description: 'patterns with documentation'
			}, {
				type: 'quality',
				key: 'dependencies',
				value: [field.key, op.key, 'dependencies'].join(''),
				description: 'patterns with dependencies'
			}, {
				type: 'quality',
				key: 'dependents',
				value: [field.key, op.key, 'dependents'].join(''),
				description: 'patterns with dependents'
			}, {
				type: 'quality',
				key: 'tags',
				value: [field.key, op.key, 'tags'].join(''),
				description: 'patterns with tags'
			}];
		case 'depends':
		case 'provides':
			return patterns.filter(function (item) {
				return item.id.startsWith(parsed.value || '');
			}).map(function (item) {
				return {
					type: 'pattern',
					key: item.id,
					value: [field.key, op.key, item.id].join(''),
					description: '' + item.id
				};
			});
		case 'tags':
			return (0, _lodash.uniq)((0, _lodash.flatten)(patterns.map(function (item) {
				return item.manifest.tags;
			}))).filter(Boolean).map(function (tag) {
				return {
					type: 'tag',
					key: tag,
					value: [field.key, op.key, tag].join(''),
					description: tag
				};
			});
		case 'version':
			{
				var versions = (0, _lodash.uniqBy)(patterns.filter(function (item) {
					return item.manifest.version.startsWith(parsed.value || '');
				}).map(function (item) {
					return item.manifest.version;
				})).filter(function (version) {
					return _semver2.default.valid(version);
				}).sort(function (a, b) {
					return _semver2.default.gt(a, b) ? 1 : -1;
				});

				return versions.map(function (v) {
					return {
						type: 'version',
						key: v,
						value: [field.key, op.key, v].join(''),
						description: '' + v
					};
				});
			}
		case 'flag':
			{
				var flags = (0, _lodash.uniqBy)(patterns.filter(function (item) {
					return item.manifest.flag.startsWith(parsed.value || '');
				}).map(function (item) {
					return item.manifest.flag;
				})).filter(function (flag) {
					return typeof flag === 'string';
				}).sort(function (a, b) {
					var delta = (FLAGS[a] || 0) - (FLAGS[b] || 0);
					return delta === 0 ? a.localeCompare(b) : delta;
				});

				return flags.map(function (f) {
					return {
						type: 'flag',
						key: f,
						value: [field.key, op.key, f].join(''),
						description: '' + f
					};
				});
			}
		default:
			return [];
	}
});

var selectLegend = exports.selectLegend = (0, _reselect.createSelector)(selectParsedValue, selectParsedQuery, selectFields, selectFieldHit, selectOps, selectOpsHit, selectOptions, function (parsedValue, parsed, fields, fieldHit, ops, opsHit, options, optionsHit) {
	if (parsedValue && parsedValue.values) {
		return {
			name: '',
			items: []
		};
	}

	if (!fieldHit) {
		return {
			name: 'Fields',
			items: fields
		};
	}

	if (!opsHit && !parsed.value) {
		return {
			name: 'Operators',
			items: ops
		};
	}

	if (!optionsHit && fieldHit && opsHit) {
		return {
			name: fieldHit.key,
			items: options
		};
	}

	return {};
});

var selectDocs = exports.selectDocs = (0, _reselect.createSelector)(selectFound, function (found) {
	return found.filter(function (f) {
		return f.type === 'doc';
	});
});

var selectSuggestion = exports.selectSuggestion = (0, _reselect.createSelector)(function (state) {
	return state.searchValue;
}, _pool2.default, selectLegend, function (search, pool, legend) {
	if (typeof search !== 'string' || search.length === 0) {
		return '';
	}

	var match = pool.find(function (m) {
		return [m.id, m.name, (m.manifest || {}).displayName].some(function (k) {
			return k && k.startsWith(search);
		});
	});

	if (match) {
		return [match.id, match.name, match.manifest.displayName].find(function (k) {
			return k && k.startsWith(search);
		}) || '';
	}

	var lmatch = (legend.items || []).find(function (i) {
		return i.value.startsWith(search);
	});
	return lmatch ? lmatch.value : null;
});

var selectActiveItem = exports.selectActiveItem = (0, _reselect.createSelector)(function (state) {
	return state;
}, selectFound, function (state) {
	return state.searchPreview;
}, function (state, found, preview) {
	var index = Math.min(preview, found.length - 1);
	var item = found[index];
	var selectItem = function selectItem() {
		return item;
	};
	var rel = item ? function (key) {
		return (0, _relation2.default)(key, selectItem)(state);
	} : function (i) {
		return i;
	};

	return item ? _seamlessImmutable2.default.merge(item, {
		index: index,
		demoDependents: rel('demoDependents'),
		demoDependencies: rel('demoDependencies'),
		dependents: rel('dependents'),
		dependencies: rel('dependencies')
	}) : item;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9hcHBsaWNhdGlvbi9zZWxlY3RvcnMvZm91bmQuanMiXSwibmFtZXMiOlsiRkxBR1MiLCJhbHBoYSIsImJldGEiLCJyYyIsInN0YWJsZSIsImRlcHJlY2F0ZWQiLCJGSUVMRFMiLCJ0eXBlIiwia2V5IiwidmFsdWUiLCJkZXNjcmlwdGlvbiIsIm9wZXJhdG9ycyIsIk9QRVJBVE9SUyIsInNlbGVjdEZ1c2UiLCJwb29sIiwiaWQiLCJrZXlzIiwic2VsZWN0TWF0Y2hlcyIsInN0YXRlIiwic2VhcmNoIiwiZnVzZSIsImxlbmd0aCIsInBlcmZvcm0iLCJxdWVyeSIsInNlbGVjdFBhcnNlZFZhbHVlIiwic2VhcmNoVmFsdWUiLCJzZWxlY3RMYXN0UXVlcnkiLCJsYXN0IiwicGFyc2VkIiwicSIsInZhbHVlcyIsImNhbmQiLCJzZWxlY3RGaWVsZHMiLCJmaWx0ZXIiLCJmIiwic3RhcnRzV2l0aCIsInNlbGVjdEZpZWxkSGl0IiwiZmluZCIsInNlbGVjdFBhcnNlZFF1ZXJ5Iiwic2VsZWN0T3BzIiwiaGl0IiwibWFwIiwib3AiLCJvIiwiaW5jbHVkZXMiLCJzZWxlY3RPcHNIaXQiLCJvcHMiLCJuZWdhdGVkIiwiaSIsInNlbGVjdEZvdW5kIiwibWF0Y2hlcyIsInNvcnRlZCIsInAiLCJtYXRjaCIsInMiLCJzZXQiLCJzZWxlY3RQYXR0ZXJucyIsImZvdW5kIiwic2VsZWN0UGF0dGVyblBvb2wiLCJzZWxlY3RPcHRpb25zIiwicGF0dGVybnMiLCJmaWVsZCIsImpvaW4iLCJpdGVtIiwibWFuaWZlc3QiLCJ0YWdzIiwiQm9vbGVhbiIsInRhZyIsInZlcnNpb25zIiwidmVyc2lvbiIsInZhbGlkIiwic29ydCIsImEiLCJiIiwiZ3QiLCJ2IiwiZmxhZ3MiLCJmbGFnIiwiZGVsdGEiLCJsb2NhbGVDb21wYXJlIiwic2VsZWN0TGVnZW5kIiwicGFyc2VkVmFsdWUiLCJmaWVsZHMiLCJmaWVsZEhpdCIsIm9wc0hpdCIsIm9wdGlvbnMiLCJvcHRpb25zSGl0IiwibmFtZSIsIml0ZW1zIiwic2VsZWN0RG9jcyIsInNlbGVjdFN1Z2dlc3Rpb24iLCJsZWdlbmQiLCJtIiwiZGlzcGxheU5hbWUiLCJzb21lIiwiayIsImxtYXRjaCIsInNlbGVjdEFjdGl2ZUl0ZW0iLCJzZWFyY2hQcmV2aWV3IiwicHJldmlldyIsImluZGV4IiwiTWF0aCIsIm1pbiIsInNlbGVjdEl0ZW0iLCJyZWwiLCJtZXJnZSIsImRlbW9EZXBlbmRlbnRzIiwiZGVtb0RlcGVuZGVuY2llcyIsImRlcGVuZGVudHMiLCJkZXBlbmRlbmNpZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOzs7Ozs7QUFFQSxJQUFNQSxRQUFRO0FBQ2JDLFFBQU8sQ0FETTtBQUViQyxPQUFNLENBRk87QUFHYkMsS0FBSSxDQUhTO0FBSWJDLFNBQVEsQ0FKSztBQUtiQyxhQUFZO0FBTEMsQ0FBZDs7QUFRQSxJQUFNQyxTQUFTLENBQ2Q7QUFDQ0MsT0FBTSxPQURQO0FBRUNDLE1BQUssU0FGTjtBQUdDQyxRQUFPLFNBSFI7QUFJQ0MsY0FBYSwwQkFKZDtBQUtDQyxZQUFXLENBQUMsR0FBRCxFQUFNLElBQU4sRUFBWSxJQUFaLEVBQWtCLElBQWxCO0FBTFosQ0FEYyxFQVFkO0FBQ0NKLE9BQU0sT0FEUDtBQUVDQyxNQUFLLEtBRk47QUFHQ0MsUUFBTyxLQUhSO0FBSUNDLGNBQWEsbUNBSmQ7QUFLQ0MsWUFBVyxDQUFDLEdBQUQsRUFBTSxJQUFOO0FBTFosQ0FSYyxFQWVkO0FBQ0NKLE9BQU0sT0FEUDtBQUVDQyxNQUFLLFVBRk47QUFHQ0MsUUFBTyxVQUhSO0FBSUNDLGNBQWEsMkJBSmQ7QUFLQ0MsWUFBVyxDQUFDLEdBQUQsRUFBTSxJQUFOLEVBQVksSUFBWixFQUFrQixJQUFsQjtBQUxaLENBZmMsRUFzQmQ7QUFDQ0osT0FBTSxPQURQO0FBRUNDLE1BQUssTUFGTjtBQUdDQyxRQUFPLE1BSFI7QUFJQ0MsY0FBYSx3QkFK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QSxTQUFLOEIsQ0FBTDtBQUFBLEVBQTNFOztBQUVBLFFBQU9lLE9BQ04sNEJBQVUwQyxLQUFWLENBQWdCMUMsSUFBaEIsRUFBc0I7QUFDckJxQyxjQURxQjtBQUVyQk0sa0JBQWdCRixJQUFJLGdCQUFKLENBRks7QUFHckJHLG9CQUFrQkgsSUFBSSxrQkFBSixDQUhHO0FBSXJCSSxjQUFZSixJQUFJLFlBQUosQ0FKUztBQUtyQkssZ0JBQWNMLElBQUksY0FBSjtBQUxPLEVBQXRCLENBRE0sR0FRTnpDLElBUkQ7QUFTQSxDQW5COEIsQ0FBekIiLCJmaWxlIjoiZm91bmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRnVzZSBmcm9tICdmdXNlLmpzJztcbmltcG9ydCBJbW11dGFibGUgZnJvbSAnc2VhbWxlc3MtaW1tdXRhYmxlJztcbmltcG9ydCB7ZmxhdHRlbiwgdW5pcSwgdW5pcUJ5LCBzb3J0Qnl9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQge2NyZWF0ZVNlbGVjdG9yfSBmcm9tICdyZXNlbGVjdCc7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5pbXBvcnQgc2VsZWN0UG9vbCBmcm9tICcuL3Bvb2wnO1xuaW1wb3J0IHthcHBseSwgcGFyc2UsIHBhcnNlVGVybX0gZnJvbSAnLi9zZWFyY2gnO1xuaW1wb3J0IGNyZWF0ZVJlbGF0aW9uU2VsZWN0b3IgZnJvbSAnLi9yZWxhdGlvbic7XG5cbmNvbnN0IEZMQUdTID0ge1xuXHRhbHBoYTogMCxcblx0YmV0YTogMSxcblx0cmM6IDIsXG5cdHN0YWJsZTogMyxcblx0ZGVwcmVjYXRlZDogNFxufTtcblxuY29uc3QgRklFTERTID0gW1xuXHR7XG5cdFx0dHlwZTogJ2ZpZWxkJyxcblx0XHRrZXk6ICdkZXBlbmRzJyxcblx0XHR2YWx1ZTogJ2RlcGVuZHMnLFxuXHRcdGRlc2NyaXB0aW9uOiAncGF0dGVybnMgZGVwZW5kaW5nIG9uIGlkJyxcblx0XHRvcGVyYXRvcnM6IFsnPScsICchPScsICdePScsICd+PSddXG5cdH0sXG5cdHtcblx0XHR0eXBlOiAnZmllbGQnLFxuXHRcdGtleTogJ2hhcycsXG5cdFx0dmFsdWU6ICdoYXMnLFxuXHRcdGRlc2NyaXB0aW9uOiAncGF0dGVybiBmZWF0dXJpbmcgZGF0YSBvZiBbdmFsdWVdJyxcblx0XHRvcGVyYXRvcnM6IFsnPScsICchPSddXG5cdH0sXG5cdHtcblx0XHR0eXBlOiAnZmllbGQnLFxuXHRcdGtleTogJ3Byb3ZpZGVzJyxcblx0XHR2YWx1ZTogJ3Byb3ZpZGVzJyxcblx0XHRkZXNjcmlwdGlvbjogJ3BhdHRlcm5zIHByb3ZpZGluZyBmb3IgaWQnLFxuXHRcdG9wZXJhdG9yczogWyc9JywgJyE9JywgJ149JywgJ349J11cblx0fSxcblx0e1xuXHRcdHR5cGU6ICdmaWVsZCcsXG5cdFx0a2V5OiAndGFncycsXG5cdFx0dmFsdWU6ICd0YWdzJyxcblx0XHRkZXNjcmlwdGlvbjogJ3BhdHRlcm4gbWFuaWZlc3QgLnRhZ3MnLFxuXHRcdG9wZXJhdG9yczogWyc9JywgJyE9JywgJ149JywgJ349J11cblx0fSxcblx0e1xuXHRcdHR5cGU6ICdmaWVsZCcsXG5cdFx0a2V5OiAndmVyc2lvbicsXG5cdFx0dmFsdWU6ICd2ZXJzaW9uJyxcblx0XHRkZXNjcmlwdGlvbjogJ3NlbWFudGljIHZlcnNpb24gb2YgcGF0dGVybicsXG5cdFx0b3BlcmF0b3JzOiBbJz0nLCAnIT0nLCAnPicsICc+PScsICc8JywgJzw9JywgJ149JywgJ349J11cblx0fSxcblx0e1xuXHRcdHR5cGU6ICdmaWVsZCcsXG5cdFx0a2V5OiAnZmxhZycsXG5cdFx0dmFsdWU6ICdmbGFnJyxcblx0XHRkZXNjcmlwdGlvbjogJ3N0YWJpbGl0eSBmbGFnIG9mIHBhdHRlcm4nLFxuXHRcdG9wZXJhdG9yczogWyc9JywgJyE9JywgJz4nLCAnPj0nLCAnPCcsICc8PScsICdePScsICd+PSddXG5cdH1cbl07XG5cbmNvbnN0IE9QRVJBVE9SUyA9IFtcblx0e1xuXHRcdHR5cGU6ICdvcCcsXG5cdFx0a2V5OiAnPScsXG5cdFx0ZGVzY3JpcHRpb246ICdleGFjdCBtYXRjaCdcblx0fSxcblx0e1xuXHRcdHR5cGU6ICdvcCcsXG5cdFx0a2V5OiAnIT0nLFxuXHRcdGRlc2NyaXB0aW9uOiAnbmVnYXRlZCBtYXRjaCdcblx0fSxcblx0e1xuXHRcdHR5cGU6ICdvcCcsXG5cdFx0a2V5OiAnPicsXG5cdFx0ZGVzY3JpcHRpb246ICdncmVhdGVyIHRoYW4nXG5cdH0sXG5cdHtcblx0XHR0eXBlOiAnb3AnLFxuXHRcdGtleTogJz49Jyxcblx0XHRkZXNjcmlwdGlvbjogJ2dyZWF0ZXIgdGhhbiBvciBlcXVhbCdcblx0fSxcblx0e1xuXHRcdHR5cGU6ICdvcCcsXG5cdFx0a2V5OiAnPCcsXG5cdFx0ZGVzY3JpcHRpb246ICdsZXNzZXIgdGhhbidcblx0fSxcblx0e1xuXHRcdHR5cGU6ICdvcCcsXG5cdFx0a2V5OiAnPD0nLFxuXHRcdGRlc2NyaXB0aW9uOiAnbGVzc2VyIHRoYW4gb3IgZXF1YWwnXG5cdH0sXG5cdHtcblx0XHR0eXBlOiAnb3AnLFxuXHRcdGtleTogJ149Jyxcblx0XHRkZXNjcmlwdGlvbjogJ3N0YXJ0cyB3aXRoJ1xuXHR9LFxuXHR7XG5cdFx0dHlwZTogJ29wJyxcblx0XHRrZXk6ICd+PScsXG5cdFx0ZGVzY3JpcHRpb246ICdjb250YWlucydcblx0fVxuXTtcblxuY29uc3Qgc2VsZWN0RnVzZSA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzZWxlY3RQb29sLFxuXHRwb29sID0+IHtcblx0XHRyZXR1cm4gbmV3IEZ1c2UocG9vbCwge1xuXHRcdFx0aWQ6ICdpZCcsXG5cdFx0XHRrZXlzOiBbXG5cdFx0XHRcdCdpZCcsXG5cdFx0XHRcdCdjb250ZW50cycsXG5cdFx0XHRcdCdtYWluZmVzdC5kaXNwbGF5TmFtZScsXG5cdFx0XHRcdCdtYW5pZmVzdC5uYW1lJyxcblx0XHRcdFx0J21hbmlmZXN0LnZlcnNpb24nLFxuXHRcdFx0XHQnbWFuaWZlc3QudGFncycsXG5cdFx0XHRcdCdtYW5pZmVzdC5mbGFnJ1xuXHRcdFx0XVxuXHRcdH0pO1xuXHR9XG4pO1xuXG5jb25zdCBzZWxlY3RNYXRjaGVzID0gY3JlYXRlU2VsZWN0b3IoXG5cdHN0YXRlID0+IHN0YXRlLnNlYXJjaCxcblx0c2VsZWN0RnVzZSxcblx0c2VsZWN0UG9vbCxcblx0KHNlYXJjaCwgZnVzZSwgcG9vbCkgPT4ge1xuXHRcdGlmICh0eXBlb2Ygc2VhcmNoICE9PSAnc3RyaW5nJyB8fCBzZWFyY2gubGVuZ3RoIDwgMykge1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdGNvbnN0IHBlcmZvcm0gPSBhcHBseShmdXNlLCBwb29sKTtcblx0XHRjb25zdCBxdWVyeSA9IHBhcnNlKHNlYXJjaCk7XG5cdFx0cmV0dXJuIHBlcmZvcm0ocXVlcnkpO1xuXHR9XG4pO1xuXG5jb25zdCBzZWxlY3RQYXJzZWRWYWx1ZSA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzdGF0ZSA9PiBzdGF0ZS5zZWFyY2hWYWx1ZSxcblx0c2VhcmNoID0+IHBhcnNlKHNlYXJjaClcbik7XG5cbmNvbnN0IHNlbGVjdExhc3RRdWVyeSA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzZWxlY3RQYXJzZWRWYWx1ZSxcblx0cGFyc2VkID0+IGxhc3QocGFyc2VkKVxuKTtcblxuZnVuY3Rpb24gbGFzdChxdWVyeSkge1xuXHRzd2l0Y2ggKHF1ZXJ5LnR5cGUpIHtcblx0XHRjYXNlICdzdHJpbmcnOlxuXHRcdFx0cmV0dXJuIHF1ZXJ5LnZhbHVlO1xuXHRcdGNhc2UgJ2FuZCc6XG5cdFx0Y2FzZSAnb3InOlxuXHRcdGRlZmF1bHQ6IHtcblx0XHRcdGNvbnN0IHEgPSBxdWVyeSB8fCB7fTtcblx0XHRcdGNvbnN0IHZhbHVlcyA9IHEudmFsdWVzIHx8IFtdO1xuXHRcdFx0Y29uc3QgY2FuZCA9IHZhbHVlc1t2YWx1ZXMubGVuZ3RoIC0gMV07XG5cdFx0XHRyZXR1cm4gY2FuZCA/IGxhc3QoY2FuZCkgOiAnJztcblx0XHR9XG5cdH1cbn1cblxuY29uc3Qgc2VsZWN0RmllbGRzID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdExhc3RRdWVyeSxcblx0cXVlcnkgPT4gRklFTERTLmZpbHRlcihmID0+IGYudmFsdWUuc3RhcnRzV2l0aChxdWVyeSkpXG4pO1xuXG5jb25zdCBzZWxlY3RGaWVsZEhpdCA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzdGF0ZSA9PiBzdGF0ZS5zZWFyY2hWYWx1ZSxcblx0c2VsZWN0TGFzdFF1ZXJ5LFxuXHQodmFsdWUsIHF1ZXJ5KSA9PiB7XG5cdFx0aWYgKHF1ZXJ5Lmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIEZJRUxEUy5maW5kKGYgPT4gcXVlcnkuc3RhcnRzV2l0aChmLnZhbHVlKSk7XG5cdH1cbik7XG5cbmNvbnN0IHNlbGVjdFBhcnNlZFF1ZXJ5ID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdExhc3RRdWVyeSxcblx0cXVlcnkgPT4gcGFyc2VUZXJtKHF1ZXJ5KVxuKTtcblxuY29uc3Qgc2VsZWN0T3BzID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdFBhcnNlZFF1ZXJ5LFxuXHRzZWxlY3RGaWVsZEhpdCxcblx0KHBhcnNlZCwgaGl0KSA9PiB7XG5cdFx0aWYgKCFoaXQpIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cdFx0cmV0dXJuIGhpdC5vcGVyYXRvcnNcblx0XHRcdC5tYXAobyA9PiBPUEVSQVRPUlMuZmluZChvcCA9PiBvcC5rZXkgPT09IG8pKVxuXHRcdFx0LmZpbHRlcihvID0+ICFwYXJzZWQub3BlcmF0b3JzIHx8IG8ua2V5LmluY2x1ZGVzKHBhcnNlZC5vcGVyYXRvcnMpKVxuXHRcdFx0Lm1hcChvID0+IHtcblx0XHRcdFx0by52YWx1ZSA9IGAke2hpdC52YWx1ZX0ke28ua2V5fWA7XG5cdFx0XHRcdHJldHVybiBvO1xuXHRcdFx0fSk7XG5cdH1cbik7XG5cbmNvbnN0IHNlbGVjdE9wc0hpdCA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzZWxlY3RQYXJzZWRRdWVyeSxcblx0c2VsZWN0T3BzLFxuXHQocXVlcnksIG9wcykgPT4ge1xuXHRcdHJldHVybiBvcHMuZmluZChpID0+IHtcblx0XHRcdGlmIChxdWVyeS5uZWdhdGVkKSB7XG5cdFx0XHRcdHJldHVybiBpLmtleSA9PT0gYCEke3F1ZXJ5Lm9wZXJhdG9yc31gO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGkua2V5ID09PSBxdWVyeS5vcGVyYXRvcnM7XG5cdFx0fSk7XG5cdH1cbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RGb3VuZCA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzZWxlY3RQb29sLFxuXHRzZWxlY3RNYXRjaGVzLFxuXHQocG9vbCwgbWF0Y2hlcykgPT4ge1xuXHRcdGNvbnN0IHNvcnRlZCA9IHVuaXFCeShzb3J0QnkobWF0Y2hlcy5tYXAobWF0Y2ggPT4gcG9vbC5maW5kKHAgPT4gcC5pZCA9PT0gbWF0Y2gpKSwgJ3R5cGUnKSwgJ2lkJyk7XG5cdFx0cmV0dXJuIHNvcnRlZFxuXHRcdFx0LmZpbHRlcihzID0+IHMudHlwZSAhPT0gJ2ZvbGRlcicpXG5cdFx0XHQubWFwKChzLCBpKSA9PiBJbW11dGFibGUuc2V0KHMsICdpbmRleCcsIGkpKTtcblx0fVxuKTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdFBhdHRlcm5zID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEZvdW5kLFxuXHRmb3VuZCA9PiBmb3VuZC5maWx0ZXIoZiA9PiBmLnR5cGUgPT09ICdwYXR0ZXJuJylcbik7XG5cbmNvbnN0IHNlbGVjdFBhdHRlcm5Qb29sID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdFBvb2wsXG5cdHBvb2wgPT4gcG9vbC5maWx0ZXIoZiA9PiBmLnR5cGUgPT09ICdwYXR0ZXJuJylcbik7XG5cbmNvbnN0IHNlbGVjdE9wdGlvbnMgPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0UGF0dGVyblBvb2wsXG5cdHNlbGVjdFBhcnNlZFF1ZXJ5LFxuXHRzZWxlY3RGaWVsZEhpdCxcblx0c2VsZWN0T3BzSGl0LFxuXHQocGF0dGVybnMsIHBhcnNlZCwgZmllbGQsIG9wKSA9PiB7XG5cdFx0aWYgKCFmaWVsZCB8fCAhb3ApIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHRzd2l0Y2ggKGZpZWxkLmtleSkge1xuXHRcdFx0Y2FzZSAnaGFzJzpcblx0XHRcdFx0cmV0dXJuIFtcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHR0eXBlOiAncXVhbGl0eScsXG5cdFx0XHRcdFx0XHRrZXk6ICdkb2NzJyxcblx0XHRcdFx0XHRcdHZhbHVlOiBbZmllbGQua2V5LCBvcC5rZXksICdkb2NzJ10uam9pbignJyksXG5cdFx0XHRcdFx0XHRkZXNjcmlwdGlvbjogJ3BhdHRlcm5zIHdpdGggZG9jdW1lbnRhdGlvbidcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHR5cGU6ICdxdWFsaXR5Jyxcblx0XHRcdFx0XHRcdGtleTogJ2RlcGVuZGVuY2llcycsXG5cdFx0XHRcdFx0XHR2YWx1ZTogW2ZpZWxkLmtleSwgb3Aua2V5LCAnZGVwZW5kZW5jaWVzJ10uam9pbignJyksXG5cdFx0XHRcdFx0XHRkZXNjcmlwdGlvbjogJ3BhdHRlcm5zIHdpdGggZGVwZW5kZW5jaWVzJ1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0dHlwZTogJ3F1YWxpdHknLFxuXHRcdFx0XHRcdFx0a2V5OiAnZGVwZW5kZW50cycsXG5cdFx0XHRcdFx0XHR2YWx1ZTogW2ZpZWxkLmtleSwgb3Aua2V5LCAnZGVwZW5kZW50cyddLmpvaW4oJycpLFxuXHRcdFx0XHRcdFx0ZGVzY3JpcHRpb246ICdwYXR0ZXJucyB3aXRoIGRlcGVuZGVudHMnXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHR0eXBlOiAncXVhbGl0eScsXG5cdFx0XHRcdFx0XHRrZXk6ICd0YWdzJyxcblx0XHRcdFx0XHRcdHZhbHVlOiBbZmllbGQua2V5LCBvcC5rZXksICd0YWdzJ10uam9pbignJyksXG5cdFx0XHRcdFx0XHRkZXNjcmlwdGlvbjogJ3BhdHRlcm5zIHdpdGggdGFncydcblx0XHRcdFx0XHR9XG5cdFx0XHRcdF07XG5cdFx0XHRjYXNlICdkZXBlbmRzJzpcblx0XHRcdGNhc2UgJ3Byb3ZpZGVzJzpcblx0XHRcdFx0cmV0dXJuIHBhdHRlcm5zXG5cdFx0XHRcdFx0LmZpbHRlcihpdGVtID0+IGl0ZW0uaWQuc3RhcnRzV2l0aChwYXJzZWQudmFsdWUgfHwgJycpKVxuXHRcdFx0XHRcdC5tYXAoaXRlbSA9PiB7XG5cdFx0XHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiAncGF0dGVybicsXG5cdFx0XHRcdFx0XHRcdGtleTogaXRlbS5pZCxcblx0XHRcdFx0XHRcdFx0dmFsdWU6IFtmaWVsZC5rZXksIG9wLmtleSwgaXRlbS5pZF0uam9pbignJyksXG5cdFx0XHRcdFx0XHRcdGRlc2NyaXB0aW9uOiBgJHtpdGVtLmlkfWBcblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRjYXNlICd0YWdzJzpcblx0XHRcdFx0cmV0dXJuIHVuaXEoZmxhdHRlbihwYXR0ZXJucy5tYXAoaXRlbSA9PiBpdGVtLm1hbmlmZXN0LnRhZ3MpKSlcblx0XHRcdFx0XHQuZmlsdGVyKEJvb2xlYW4pXG5cdFx0XHRcdFx0Lm1hcCh0YWcgPT4ge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRcdFx0dHlwZTogJ3RhZycsXG5cdFx0XHRcdFx0XHRcdGtleTogdGFnLFxuXHRcdFx0XHRcdFx0XHR2YWx1ZTogW2ZpZWxkLmtleSwgb3Aua2V5LCB0YWddLmpvaW4oJycpLFxuXHRcdFx0XHRcdFx0XHRkZXNjcmlwdGlvbjogdGFnXG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0Y2FzZSAndmVyc2lvbic6IHtcblx0XHRcdFx0Y29uc3QgdmVyc2lvbnMgPSB1bmlxQnkocGF0dGVybnMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5tYW5pZmVzdC52ZXJzaW9uLnN0YXJ0c1dpdGgocGFyc2VkLnZhbHVlIHx8ICcnKSlcblx0XHRcdFx0XHQubWFwKGl0ZW0gPT4gaXRlbS5tYW5pZmVzdC52ZXJzaW9uKSlcblx0XHRcdFx0XHQuZmlsdGVyKHZlcnNpb24gPT4gc2VtdmVyLnZhbGlkKHZlcnNpb24pKVxuXHRcdFx0XHRcdC5zb3J0KChhLCBiKSA9PiBzZW12ZXIuZ3QoYSwgYikgPyAxIDogLTEpO1xuXG5cdFx0XHRcdHJldHVybiB2ZXJzaW9ucy5tYXAodiA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRcdHR5cGU6ICd2ZXJzaW9uJyxcblx0XHRcdFx0XHRcdGtleTogdixcblx0XHRcdFx0XHRcdHZhbHVlOiBbZmllbGQua2V5LCBvcC5rZXksIHZdLmpvaW4oJycpLFxuXHRcdFx0XHRcdFx0ZGVzY3JpcHRpb246IGAke3Z9YFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0Y2FzZSAnZmxhZyc6IHtcblx0XHRcdFx0Y29uc3QgZmxhZ3MgPSB1bmlxQnkocGF0dGVybnMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5tYW5pZmVzdC5mbGFnLnN0YXJ0c1dpdGgocGFyc2VkLnZhbHVlIHx8ICcnKSlcblx0XHRcdFx0XHQubWFwKGl0ZW0gPT4gaXRlbS5tYW5pZmVzdC5mbGFnKSlcblx0XHRcdFx0XHQuZmlsdGVyKGZsYWcgPT4gdHlwZW9mIGZsYWcgPT09ICdzdHJpbmcnKVxuXHRcdFx0XHRcdC5zb3J0KChhLCBiKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zdCBkZWx0YSA9IChGTEFHU1thXSB8fCAwKSAtIChGTEFHU1tiXSB8fCAwKTtcblx0XHRcdFx0XHRcdHJldHVybiBkZWx0YSA9PT0gMCA/IGEubG9jYWxlQ29tcGFyZShiKSA6IGRlbHRhO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJldHVybiBmbGFnc1xuXHRcdFx0XHRcdC5tYXAoZiA9PiB7XG5cdFx0XHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiAnZmxhZycsXG5cdFx0XHRcdFx0XHRcdGtleTogZixcblx0XHRcdFx0XHRcdFx0dmFsdWU6IFtmaWVsZC5rZXksIG9wLmtleSwgZl0uam9pbignJyksXG5cdFx0XHRcdFx0XHRcdGRlc2NyaXB0aW9uOiBgJHtmfWBcblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXHR9XG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0TGVnZW5kID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdFBhcnNlZFZhbHVlLFxuXHRzZWxlY3RQYXJzZWRRdWVyeSxcblx0c2VsZWN0RmllbGRzLFxuXHRzZWxlY3RGaWVsZEhpdCxcblx0c2VsZWN0T3BzLFxuXHRzZWxlY3RPcHNIaXQsXG5cdHNlbGVjdE9wdGlvbnMsXG5cdChwYXJzZWRWYWx1ZSwgcGFyc2VkLCBmaWVsZHMsIGZpZWxkSGl0LCBvcHMsIG9wc0hpdCwgb3B0aW9ucywgb3B0aW9uc0hpdCkgPT4ge1xuXHRcdGlmIChwYXJzZWRWYWx1ZSAmJiBwYXJzZWRWYWx1ZS52YWx1ZXMpIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdG5hbWU6ICcnLFxuXHRcdFx0XHRpdGVtczogW11cblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0aWYgKCFmaWVsZEhpdCkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0bmFtZTogJ0ZpZWxkcycsXG5cdFx0XHRcdGl0ZW1zOiBmaWVsZHNcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0aWYgKCFvcHNIaXQgJiYgIXBhcnNlZC52YWx1ZSkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0bmFtZTogJ09wZXJhdG9ycycsXG5cdFx0XHRcdGl0ZW1zOiBvcHNcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0aWYgKCFvcHRpb25zSGl0ICYmIGZpZWxkSGl0ICYmIG9wc0hpdCkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0bmFtZTogZmllbGRIaXQua2V5LFxuXHRcdFx0XHRpdGVtczogb3B0aW9uc1xuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRyZXR1cm4ge307XG5cdH1cbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3REb2NzID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEZvdW5kLFxuXHRmb3VuZCA9PiBmb3VuZC5maWx0ZXIoZiA9PiBmLnR5cGUgPT09ICdkb2MnKVxuKTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdFN1Z2dlc3Rpb24gPSBjcmVhdGVTZWxlY3Rvcihcblx0c3RhdGUgPT4gc3RhdGUuc2VhcmNoVmFsdWUsXG5cdHNlbGVjdFBvb2wsXG5cdHNlbGVjdExlZ2VuZCxcblx0KHNlYXJjaCwgcG9vbCwgbGVnZW5kKSA9PiB7XG5cdFx0aWYgKHR5cGVvZiBzZWFyY2ggIT09ICdzdHJpbmcnIHx8IHNlYXJjaC5sZW5ndGggPT09IDApIHtcblx0XHRcdHJldHVybiAnJztcblx0XHR9XG5cblx0XHRjb25zdCBtYXRjaCA9IHBvb2wuZmluZChtID0+IFttLmlkLCBtLm5hbWUsIChtLm1hbmlmZXN0IHx8IHt9KS5kaXNwbGF5TmFtZV0uc29tZShrID0+IGsgJiYgay5zdGFydHNXaXRoKHNlYXJjaCkpKTtcblxuXHRcdGlmIChtYXRjaCkge1xuXHRcdFx0cmV0dXJuIFttYXRjaC5pZCwgbWF0Y2gubmFtZSwgbWF0Y2gubWFuaWZlc3QuZGlzcGxheU5hbWVdLmZpbmQoayA9PiBrICYmIGsuc3RhcnRzV2l0aChzZWFyY2gpKSB8fCAnJztcblx0XHR9XG5cblx0XHRjb25zdCBsbWF0Y2ggPSAobGVnZW5kLml0ZW1zIHx8IFtdKS5maW5kKGkgPT4gaS52YWx1ZS5zdGFydHNXaXRoKHNlYXJjaCkpO1xuXHRcdHJldHVybiBsbWF0Y2ggPyBsbWF0Y2gudmFsdWUgOiBudWxsO1xuXHR9XG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0QWN0aXZlSXRlbSA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzdGF0ZSA9PiBzdGF0ZSxcblx0c2VsZWN0Rm91bmQsXG5cdHN0YXRlID0+IHN0YXRlLnNlYXJjaFByZXZpZXcsXG5cdChzdGF0ZSwgZm91bmQsIHByZXZpZXcpID0+IHtcblx0XHRjb25zdCBpbmRleCA9IE1hdGgubWluKHByZXZpZXcsIGZvdW5kLmxlbmd0aCAtIDEpO1xuXHRcdGNvbnN0IGl0ZW0gPSBmb3VuZFtpbmRleF07XG5cdFx0Y29uc3Qgc2VsZWN0SXRlbSA9ICgpID0+IGl0ZW07XG5cdFx0Y29uc3QgcmVsID0gaXRlbSA/IGtleSA9PiBjcmVhdGVSZWxhdGlvblNlbGVjdG9yKGtleSwgc2VsZWN0SXRlbSkoc3RhdGUpIDogaSA9PiBpO1xuXG5cdFx0cmV0dXJuIGl0ZW0gP1xuXHRcdFx0SW1tdXRhYmxlLm1lcmdlKGl0ZW0sIHtcblx0XHRcdFx0aW5kZXgsXG5cdFx0XHRcdGRlbW9EZXBlbmRlbnRzOiByZWwoJ2RlbW9EZXBlbmRlbnRzJyksXG5cdFx0XHRcdGRlbW9EZXBlbmRlbmNpZXM6IHJlbCgnZGVtb0RlcGVuZGVuY2llcycpLFxuXHRcdFx0XHRkZXBlbmRlbnRzOiByZWwoJ2RlcGVuZGVudHMnKSxcblx0XHRcdFx0ZGVwZW5kZW5jaWVzOiByZWwoJ2RlcGVuZGVuY2llcycpXG5cdFx0XHR9KSA6XG5cdFx0XHRpdGVtO1xuXHR9XG4pO1xuIl19