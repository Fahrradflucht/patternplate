'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.selectContents = exports.selectEnvs = exports.selectEnv = exports.selectId = exports.selectFlag = exports.selectVersion = exports.selectTags = exports.selectName = exports.selectIcon = exports.selectAutomount = exports.selectActive = exports.selectType = exports.selectManifest = exports.selectDependents = exports.selectDependencies = exports.selectDemoDependents = exports.selectDemoDependencies = undefined;

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _reselect = require('reselect');

var _pool = require('./pool');

var _pool2 = _interopRequireDefault(_pool);

var _relation = require('./relation');

var _relation2 = _interopRequireDefault(_relation);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var REGISTRY = {
	'/': 'doc/root'
};

var selectItem = (0, _reselect.createSelector)(_pool2.default, function (state) {
	return state.id;
}, function (pool, id) {
	var search = id in REGISTRY ? REGISTRY[id] : id;
	return pool.find(function (item) {
		return search === item.type + '/' + item.id;
	});
});

exports.default = selectItem;


var filter = function filter(hidden) {
	return hidden ? function (item) {
		return (item.manifest.options || {}).hidden !== true;
	} : function (i) {
		return i;
	};
};

var selectFilter = (0, _reselect.createSelector)(function (state) {
	return state.hide;
}, function (hide) {
	return filter(hide);
});

var relation = function relation(key) {
	return (0, _relation2.default)(key, selectItem, selectFilter);
};

var selectDemoDependencies = exports.selectDemoDependencies = relation('demoDependencies');
var selectDemoDependents = exports.selectDemoDependents = relation('demoDependents');
var selectDependencies = exports.selectDependencies = relation('dependencies');
var selectDependents = exports.selectDependents = relation('dependents');

var selectManifest = exports.selectManifest = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? (0, _stringify2.default)(item.manifest, null, '  ') : '';
});

var selectType = exports.selectType = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? item.type : '';
});

var selectActive = exports.selectActive = (0, _reselect.createSelector)(selectItem, function (state) {
	return state.searchEnabled;
}, function (item, search) {
	return !search && item !== null && typeof item !== 'undefined';
});

var selectOptions = (0, _reselect.createSelector)(selectItem, function (item) {
	return item.manifest.options || {};
});

var selectReactToMarkup = (0, _reselect.createSelector)(selectOptions, function (options) {
	return options['react-to-markup'] || {};
});

var selectReactToMarkupOpts = (0, _reselect.createSelector)(selectReactToMarkup, function (r) {
	return r.opts || {};
});

var selectAutomount = exports.selectAutomount = (0, _reselect.createSelector)(selectReactToMarkupOpts, function (state) {
	return state.schema.automount;
}, function (state) {
	return state.mountEnabled;
}, function (opts, globalConfig, enabled) {
	if (enabled !== null) {
		return enabled;
	}

	return 'automount' in opts ? opts.automount : globalConfig;
});

var selectIcon = exports.selectIcon = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? item.manifest.icon || item.type : '';
});

var selectName = exports.selectName = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? item.manifest.displayName : '';
});

var selectTags = exports.selectTags = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? item.manifest.tags : [];
});

var selectVersion = exports.selectVersion = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? item.manifest.version : '';
});

var selectFlag = exports.selectFlag = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? item.manifest.flag : '';
});

var selectId = exports.selectId = (0, _reselect.createSelector)(selectItem, function (item) {
	return item ? item.id : '';
});

var selectEnv = exports.selectEnv = (0, _reselect.createSelector)(function (state) {
	return state.environment;
}, function (state) {
	return state.schema.envs;
}, function (env, envs) {
	var found = envs.find(function (e) {
		return e.name === env;
	});
	return {
		name: found.name,
		displayName: found.displayName
	};
});

var selectEnvs = exports.selectEnvs = (0, _reselect.createSelector)(selectItem, function (state) {
	return state.schema.envs;
}, function (item, envs) {
	if (!item) {
		return [];
	}

	return (item.envs || []).map(function (e) {
		var found = envs.find(function (env) {
			return env.name === e;
		});
		return {
			name: found.name,
			displayName: found.displayName
		};
	});
});

var selectContents = exports.selectContents = (0, _reselect.createSelector)(selectItem, function (item) {
	if (!item) {
		return null;
	}
	return typeof item.contents === 'string' ? item.contents : null;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9hcHBsaWNhdGlvbi9zZWxlY3RvcnMvaXRlbS5qcyJdLCJuYW1lcyI6WyJSRUdJU1RSWSIsInNlbGVjdEl0ZW0iLCJzdGF0ZSIsImlkIiwicG9vbCIsInNlYXJjaCIsImZpbmQiLCJpdGVtIiwidHlwZSIsImZpbHRlciIsImhpZGRlbiIsIm1hbmlmZXN0Iiwib3B0aW9ucyIsImkiLCJzZWxlY3RGaWx0ZXIiLCJoaWRlIiwicmVsYXRpb24iLCJrZXkiLCJzZWxlY3REZW1vRGVwZW5kZW5jaWVzIiwic2VsZWN0RGVtb0RlcGVuZGVudHMiLCJzZWxlY3REZXBlbmRlbmNpZXMiLCJzZWxlY3REZXBlbmRlbnRzIiwic2VsZWN0TWFuaWZlc3QiLCJzZWxlY3RUeXBlIiwic2VsZWN0QWN0aXZlIiwic2VhcmNoRW5hYmxlZCIsInNlbGVjdE9wdGlvbnMiLCJzZWxlY3RSZWFjdFRvTWFya3VwIiwic2VsZWN0UmVhY3RUb01hcmt1cE9wdHMiLCJyIiwib3B0cyIsInNlbGVjdEF1dG9tb3VudCIsInNjaGVtYSIsImF1dG9tb3VudCIsIm1vdW50RW5hYmxlZCIsImdsb2JhbENvbmZpZyIsImVuYWJsZWQiLCJzZWxlY3RJY29uIiwiaWNvbiIsInNlbGVjdE5hbWUiLCJkaXNwbGF5TmFtZSIsInNlbGVjdFRhZ3MiLCJ0YWdzIiwic2VsZWN0VmVyc2lvbiIsInZlcnNpb24iLCJzZWxlY3RGbGFnIiwiZmxhZyIsInNlbGVjdElkIiwic2VsZWN0RW52IiwiZW52aXJvbm1lbnQiLCJlbnZzIiwiZW52IiwiZm91bmQiLCJlIiwibmFtZSIsInNlbGVjdEVudnMiLCJtYXAiLCJzZWxlY3RDb250ZW50cyIsImNvbnRlbnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVBLElBQU1BLFdBQVc7QUFDaEIsTUFBSztBQURXLENBQWpCOztBQUlBLElBQU1DLGFBQWEsOENBRWxCO0FBQUEsUUFBU0MsTUFBTUMsRUFBZjtB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O0FBSUEsQ0FUdUIsQ0FBbEI7O0FBWUEsSUFBTWUsa0NBQWEsOEJBQ3pCdEQsVUFEeUIsRUFFekI7QUFBQSxRQUFTQyxNQUFNOEIsTUFBTixDQUFha0IsSUFBdEI7QUFBQSxDQUZ5QixFQUd6QixVQUFDM0MsSUFBRCxFQUFPMkMsSUFBUCxFQUFnQjtBQUNmLEtBQUksQ0FBQzNDLElBQUwsRUFBVztBQUNWLFNBQU8sRUFBUDtBQUNBOztBQUVELFFBQU8sQ0FBQ0EsS0FBSzJDLElBQUwsSUFBYSxFQUFkLEVBQWtCTSxHQUFsQixDQUFzQixhQUFLO0FBQ2pDLE1BQU1KLFFBQVFGLEtBQUs1QyxJQUFMLENBQVU7QUFBQSxVQUFPNkMsSUFBSUcsSUFBSixLQUFhRCxDQUFwQjtBQUFBLEdBQVYsQ0FBZDtBQUNBLFNBQU87QUFDTkMsU0FBTUYsTUFBTUUsSUFETjtBQUVOZCxnQkFBYVksTUFBTVo7QUFGYixHQUFQO0FBSUEsRUFOTSxDQUFQO0FBT0EsQ0Fmd0IsQ0FBbkI7O0FBa0JBLElBQU1pQiwwQ0FBaUIsOEJBQzdCeEQsVUFENkIsRUFFN0IsZ0JBQVE7QUFDUCxLQUFJLENBQUNNLElBQUwsRUFBVztBQUNWLFNBQU8sSUFBUDtBQUNBO0FBQ0QsUUFBTyxPQUFPQSxLQUFLbUQsUUFBWixLQUF5QixRQUF6QixHQUFvQ25ELEtBQUttRCxRQUF6QyxHQUFvRCxJQUEzRDtBQUNBLENBUDRCLENBQXZCIiwiZmlsZSI6Iml0ZW0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2NyZWF0ZVNlbGVjdG9yfSBmcm9tICdyZXNlbGVjdCc7XG5pbXBvcnQgc2VsZWN0UG9vbCBmcm9tICcuL3Bvb2wnO1xuaW1wb3J0IGNyZWF0ZVJlbGF0aW9uU2VsZWN0b3IgZnJvbSAnLi9yZWxhdGlvbic7XG5cbmNvbnN0IFJFR0lTVFJZID0ge1xuXHQnLyc6ICdkb2Mvcm9vdCdcbn07XG5cbmNvbnN0IHNlbGVjdEl0ZW0gPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0UG9vbCxcblx0c3RhdGUgPT4gc3RhdGUuaWQsXG5cdChwb29sLCBpZCkgPT4ge1xuXHRcdGNvbnN0IHNlYXJjaCA9IGlkIGluIFJFR0lTVFJZID8gUkVHSVNUUllbaWRdIDogaWQ7XG5cdFx0cmV0dXJuIHBvb2wuZmluZChpdGVtID0+IHNlYXJjaCA9PT0gYCR7aXRlbS50eXBlfS8ke2l0ZW0uaWR9YCk7XG5cdH1cbik7XG5cbmV4cG9ydCBkZWZhdWx0IHNlbGVjdEl0ZW07XG5cbmNvbnN0IGZpbHRlciA9IGhpZGRlbiA9PiB7XG5cdHJldHVybiBoaWRkZW4gPyBpdGVtID0+IChpdGVtLm1hbmlmZXN0Lm9wdGlvbnMgfHwge30pLmhpZGRlbiAhPT0gdHJ1ZSA6IGkgPT4gaTtcbn07XG5cbmNvbnN0IHNlbGVjdEZpbHRlciA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzdGF0ZSA9PiBzdGF0ZS5oaWRlLFxuXHRoaWRlID0+IGZpbHRlcihoaWRlKVxuKTtcblxuY29uc3QgcmVsYXRpb24gPSBrZXkgPT4gY3JlYXRlUmVsYXRpb25TZWxlY3RvcihrZXksIHNlbGVjdEl0ZW0sIHNlbGVjdEZpbHRlcik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3REZW1vRGVwZW5kZW5jaWVzID0gcmVsYXRpb24oJ2RlbW9EZXBlbmRlbmNpZXMnKTtcbmV4cG9ydCBjb25zdCBzZWxlY3REZW1vRGVwZW5kZW50cyA9IHJlbGF0aW9uKCdkZW1vRGVwZW5kZW50cycpO1xuZXhwb3J0IGNvbnN0IHNlbGVjdERlcGVuZGVuY2llcyA9IHJlbGF0aW9uKCdkZXBlbmRlbmNpZXMnKTtcbmV4cG9ydCBjb25zdCBzZWxlY3REZXBlbmRlbnRzID0gcmVsYXRpb24oJ2RlcGVuZGVudHMnKTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdE1hbmlmZXN0ID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEl0ZW0sXG5cdGl0ZW0gPT4gaXRlbSA/IEpTT04uc3RyaW5naWZ5KGl0ZW0ubWFuaWZlc3QsIG51bGwsICcgICcpIDogJydcbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RUeXBlID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEl0ZW0sXG5cdGl0ZW0gPT4gaXRlbSA/IGl0ZW0udHlwZSA6ICcnXG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0QWN0aXZlID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEl0ZW0sXG5cdHN0YXRlID0+IHN0YXRlLnNlYXJjaEVuYWJsZWQsXG5cdChpdGVtLCBzZWFyY2gpID0+ICFzZWFyY2ggJiYgaXRlbSAhPT0gbnVsbCAmJiB0eXBlb2YgaXRlbSAhPT0gJ3VuZGVmaW5lZCdcbik7XG5cbmNvbnN0IHNlbGVjdE9wdGlvbnMgPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0SXRlbSxcblx0aXRlbSA9PiBpdGVtLm1hbmlmZXN0Lm9wdGlvbnMgfHwge31cbik7XG5cbmNvbnN0IHNlbGVjdFJlYWN0VG9NYXJrdXAgPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0T3B0aW9ucyxcblx0b3B0aW9ucyA9PiBvcHRpb25zWydyZWFjdC10by1tYXJrdXAnXSB8fCB7fVxuKTtcblxuY29uc3Qgc2VsZWN0UmVhY3RUb01hcmt1cE9wdHMgPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0UmVhY3RUb01hcmt1cCxcblx0ciA9PiByLm9wdHMgfHwge31cbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RBdXRvbW91bnQgPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0UmVhY3RUb01hcmt1cE9wdHMsXG5cdHN0YXRlID0+IHN0YXRlLnNjaGVtYS5hdXRvbW91bnQsXG5cdHN0YXRlID0+IHN0YXRlLm1vdW50RW5hYmxlZCxcblx0KG9wdHMsIGdsb2JhbENvbmZpZywgZW5hYmxlZCkgPT4ge1xuXHRcdGlmIChlbmFibGVkICE9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gZW5hYmxlZDtcblx0XHR9XG5cblx0XHRyZXR1cm4gJ2F1dG9tb3VudCcgaW4gb3B0cyA/IG9wdHMuYXV0b21vdW50IDogZ2xvYmFsQ29uZmlnO1xuXHR9XG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0SWNvbiA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzZWxlY3RJdGVtLFxuXHRpdGVtID0+IGl0ZW0gPyBpdGVtLm1hbmlmZXN0Lmljb24gfHwgaXRlbS50eXBlIDogJydcbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3ROYW1lID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEl0ZW0sXG5cdGl0ZW0gPT4gaXRlbSA/IGl0ZW0ubWFuaWZlc3QuZGlzcGxheU5hbWUgOiAnJ1xuKTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdFRhZ3MgPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0SXRlbSxcblx0aXRlbSA9PiBpdGVtID8gaXRlbS5tYW5pZmVzdC50YWdzIDogW11cbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RWZXJzaW9uID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEl0ZW0sXG5cdGl0ZW0gPT4gaXRlbSA/IGl0ZW0ubWFuaWZlc3QudmVyc2lvbiA6ICcnXG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0RmxhZyA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzZWxlY3RJdGVtLFxuXHRpdGVtID0+IGl0ZW0gPyBpdGVtLm1hbmlmZXN0LmZsYWcgOiAnJ1xuKTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdElkID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEl0ZW0sXG5cdGl0ZW0gPT4gaXRlbSA/IGl0ZW0uaWQgOiAnJ1xuKTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdEVudiA9IGNyZWF0ZVNlbGVjdG9yKFxuXHRzdGF0ZSA9PiBzdGF0ZS5lbnZpcm9ubWVudCxcblx0c3RhdGUgPT4gc3RhdGUuc2NoZW1hLmVudnMsXG5cdChlbnYsIGVudnMpID0+IHtcblx0XHRjb25zdCBmb3VuZCA9IGVudnMuZmluZChlID0+IGUubmFtZSA9PT0gZW52KTtcblx0XHRyZXR1cm4ge1xuXHRcdFx0bmFtZTogZm91bmQubmFtZSxcblx0XHRcdGRpc3BsYXlOYW1lOiBmb3VuZC5kaXNwbGF5TmFtZVxuXHRcdH07XG5cdH1cbik7XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RFbnZzID0gY3JlYXRlU2VsZWN0b3IoXG5cdHNlbGVjdEl0ZW0sXG5cdHN0YXRlID0+IHN0YXRlLnNjaGVtYS5lbnZzLFxuXHQoaXRlbSwgZW52cykgPT4ge1xuXHRcdGlmICghaXRlbSkge1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdHJldHVybiAoaXRlbS5lbnZzIHx8IFtdKS5tYXAoZSA9PiB7XG5cdFx0XHRjb25zdCBmb3VuZCA9IGVudnMuZmluZChlbnYgPT4gZW52Lm5hbWUgPT09IGUpO1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0bmFtZTogZm91bmQubmFtZSxcblx0XHRcdFx0ZGlzcGxheU5hbWU6IGZvdW5kLmRpc3BsYXlOYW1lXG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9XG4pO1xuXG5leHBvcnQgY29uc3Qgc2VsZWN0Q29udGVudHMgPSBjcmVhdGVTZWxlY3Rvcihcblx0c2VsZWN0SXRlbSxcblx0aXRlbSA9PiB7XG5cdFx0aWYgKCFpdGVtKSB7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdFx0cmV0dXJuIHR5cGVvZiBpdGVtLmNvbnRlbnRzID09PSAnc3RyaW5nJyA/IGl0ZW0uY29udGVudHMgOiBudWxsO1xuXHR9XG4pO1xuIl19